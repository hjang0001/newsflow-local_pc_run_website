<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EconomyFlow</title>

<style>
/* --- SAME DESIGN SYSTEM AS NEWSFLOW --- */
:root {
  --bg:#f4f1ea; --card:#fff; --text:#2d2d2d; --title:#1a1a1a;
  --border:#d1d1d1; --highlight:#667eea;
  --success:#16a34a; --warning:#f59e0b; --danger:#dc2626;
}
body.dark-mode {
  --bg:#1a202c; --card:#2d3748; --text:#e2e8f0;
  --title:#fff; --border:#4a5568; --highlight:#63b3ed;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Georgia,serif;
  background:var(--bg);
  color:var(--text);
  padding:20px;
  line-height:1.6;
}
.container{max-width:1200px;margin:auto}

/* HEADER */
header{
  text-align:center;
  border-bottom:4px double var(--title);
  padding-bottom:20px;
  margin-bottom:30px;
  position:relative;
}
h1{font-size:3rem;letter-spacing:-1.5px}
.subtitle{
  font-family:sans-serif;
  font-weight:700;
  color:var(--highlight);
}
#timestamp{
  font-family:sans-serif;
  font-size:.8rem;
  opacity:.6;
  margin-top:6px;
}
.nav-link,.theme-btn{
  position:absolute;top:0;
  font-family:sans-serif;
  font-size:.85rem;
  font-weight:bold;
  padding:6px 12px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--highlight);
  border-radius:4px;
  cursor:pointer;
  text-decoration: none;
}
.nav-link{left:0;}
.theme-btn{right:0;color:var(--text)}

/* AI INTELLIGENCE BOX */
#global-intelligence-box{
  background:var(--card);
  border-left:8px solid var(--highlight);
  padding:25px;
  margin-bottom:35px;
  box-shadow:0 4px 8px rgba(0,0,0,.05);
}
.ai-title{
  font-family:sans-serif;
  font-size:1.2rem;
  font-weight:bold;
  color:var(--highlight);
  margin-bottom:5px;
}
.ai-sub{
  font-family:sans-serif; font-size:.9rem; opacity:.7; margin-bottom:15px; font-style:italic;
}
.impact{
  background:rgba(0,0,0,.03);
  padding:15px; margin-top:15px;
  border-left:4px solid var(--highlight);
  font-family:sans-serif; font-size:0.95rem;
}
.impact ul{margin-top:8px;padding-left:20px}

/* GRID LAYOUT */
#data-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(350px, 1fr));
  gap:25px;
}

/* CARDS */
.card{
  background:var(--card);
  border:1px solid var(--border);
  padding:20px;
  box-shadow:0 2px 4px rgba(0,0,0,.05);
}
.card h3{
  font-family:sans-serif;
  font-size:.9rem;
  letter-spacing:1px;
  color:var(--highlight);
  margin-bottom:15px;
  text-transform: uppercase;
  border-bottom: 1px solid var(--border);
  padding-bottom: 10px;
}

/* METRICS & TABLES */
.metric-row{
  display:flex; justify-content:space-between;
  padding:8px 0; border-bottom:1px solid var(--border);
  font-family:sans-serif; font-size:0.95rem;
}
.metric-row:last-child{border-bottom:none}
.metric-val{ font-family:monospace; font-weight:bold; font-size:1.1rem; }
.sub-val { font-size: 0.8rem; opacity: 0.7; font-weight: normal; margin-left: 5px; }

/* MINI TABLES FOR GLOBAL DATA */
.mini-table { width: 100%; border-collapse: collapse; font-family: sans-serif; font-size: 0.9rem; }
.mini-table td { padding: 6px 0; border-bottom: 1px solid var(--border); }
.mini-table td:last-child { text-align: right; font-family: monospace; font-weight: bold; }
.rank-num { color: var(--highlight); font-weight: bold; margin-right: 8px; }

/* RECESSION BADGE */
.risk-badge{
  display:inline-block; padding:5px 10px; border-radius:4px;
  font-family:sans-serif; font-size:.8rem; font-weight:bold;
  margin-top: 5px;
}
.risk-low{background:#d1fae5;color:#065f46}
.risk-moderate{background:#fef3c7;color:#92400e}
.risk-high{background:#fee2e2;color:#991b1b}
.risk-very-low{background:#d1fae5;color:#065f46}
.risk-critical{background:#fee2e2;color:#991b1b}

footer{ margin-top:50px; padding-top:20px; text-align:center; font-family:sans-serif; font-size:.8rem; opacity:.6; border-top:1px solid var(--border); }
</style>
</head>

<body>
<div class="container">
<header>
  <a href="index.html" class="nav-link">‚Üê Back to News</a>
  <h1>EconomyFlow</h1>
  <div class="subtitle">Macro Signals & Global Intelligence</div>
  <div id="timestamp">Loading data...</div>
  <button class="theme-btn" onclick="toggleTheme()" id="themeBtn">Dark Mode</button>
</header>

<div id="global-intelligence-box">
  <div class="ai-title">ü§ñ AI Analyst Outlook</div>
  <div class="ai-sub">Synthesized from Real-Time GDP, Labor & FX Data</div>
  <div id="ai-summary" style="font-size:1.1rem; margin-bottom:15px;">Loading analysis...</div>

  <div class="impact" style="border-left-color:var(--success)">
    <strong>‚úÖ What Matters Today</strong>
    <ul id="matters-list"></ul>
  </div>

  <div class="impact">
    <strong>üí° Recommended Actions</strong>
    <ul id="action-list"></ul>
  </div>

  <div class="impact" style="border-left-color:var(--warning)">
    <strong>üî≠ Strategic Outlook (3‚Äì6 Months)</strong>
    <p id="outlook-text" style="margin-top:5px"></p>
  </div>
</div>

<div id="data-grid">
  
  <div class="card">
    <h3>üá∫üá∏ U.S. Economy</h3>
    <div id="us-stats">Loading...</div>
  </div>

  <div class="card">
    <h3>üë∑ U.S. Labor Market</h3>
    <div id="labor-stats">Loading...</div>
  </div>

  <div class="card">
    <h3>üìâ Recession Model</h3>
    <div style="text-align:center; padding:15px 0;">
      <div id="risk-score" style="font-size:3rem;font-weight:bold; line-height:1">--</div>
      <div id="risk-status" class="risk-badge">Calculating...</div>
      <p id="risk-reason" style="margin-top:10px; font-size:0.85rem; opacity:0.8; font-family:sans-serif; font-style:italic;">--</p>
    </div>
  </div>

  <div class="card">
    <h3>üåç Top Economies (GDP)</h3>
    <div id="global-gdp">Loading...</div>
  </div>

  <div class="card">
    <h3>üíº Best Job Markets (Unemp.)</h3>
    <div id="global-jobs">Loading...</div>
  </div>

  <div class="card">
    <h3>üí± FX (vs USD)</h3>
    <div id="fx-stats">Loading...</div>
  </div>

</div>
</div>

<footer>¬© 2026 EconomyFlow ¬∑ NewsFlow Intelligence</footer>

<script>
// 1. THEME LOGIC
const themeBtn = document.getElementById('themeBtn');
function toggleTheme(){
  document.body.classList.toggle('dark-mode');
  const d = document.body.classList.contains('dark-mode');
  localStorage.setItem('pref-theme', d);
  themeBtn.innerText = d ? "Light Mode" : "Dark Mode";
}
if(localStorage.getItem('pref-theme')==="true"){
  document.body.classList.add('dark-mode');
  themeBtn.innerText = "Light Mode";
}

// 2. DATA RENDERING WITH CACHE-BUSTING
let loadTimeout = setTimeout(() => {
  document.getElementById('ai-summary').innerText = "‚ö†Ô∏è Data loading timeout. Please refresh or check back later.";
}, 10000);

fetch(`economyflow.json?t=${Date.now()}`)
  .then(r => r.json())
  .then(d => {
    clearTimeout(loadTimeout);
    
    const get = (id) => document.getElementById(id);

    // Timestamp
    get('timestamp').innerText = "UPDATED: " + d.last_updated_human;

    // AI Section
    if(d.ai) {
        get('ai-summary').innerText = d.ai.connected_summary;
        get('matters-list').innerHTML = d.ai.what_matters_today.map(x=>`<li>${x}</li>`).join("");
        get('action-list').innerHTML = d.ai.what_to_do_next.map(x=>`<li>${x}</li>`).join("");
        get('outlook-text').innerText = d.ai.strategic_outlook;
    } else {
        get('ai-summary').innerText = "AI Analysis pending (will appear on next update)...";
    }

    // US Economy
    get('us-stats').innerHTML = `
      <div class="metric-row"><span>GDP Growth</span><span class="metric-val">${d.us_economy.gdp_growth}% <span class="sub-val">(prev: ${d.us_economy.gdp_growth_prev}%)</span></span></div>
      <div class="metric-row"><span>Inflation</span><span class="metric-val">${d.us_economy.inflation}%</span></div>
      <div class="metric-row"><span>Interest Rate</span><span class="metric-val">${d.us_economy.interest_rate}%</span></div>
      <div class="metric-row">
        <span>Yield Curve</span>
        <span class="metric-val">
          ${d.us_economy.yield_curve}% 
          <span class="sub-val">(${d.derived_signals.yield_curve_state === "inverted" ? "‚ö†Ô∏è Inverted" : "‚úÖ Normal"})</span>
        </span>
      </div>
      <div class="metric-row"><span>Consumer Sentiment</span><span class="metric-val">${d.us_economy.consumer_sentiment || 'N/A'}</span></div>
    `;

    // US Labor (Safe fallbacks)
    get('labor-stats').innerHTML = `
      <div class="metric-row">
         <span>Unemployment</span>
         <span class="metric-val">
           ${d.us_economy.unemployment}% 
           <span class="sub-val">(prev: ${d.us_economy.unemployment_prev}%)</span>
         </span>
      </div>
      <div class="metric-row">
        <span>Total Jobs</span>
        <span class="metric-val">${d.us_labor?.total_employment ? (d.us_labor.total_employment/1000).toFixed(1) + 'M' : 'N/A'}</span>
      </div>
      <div class="metric-row">
        <span>Avg Hourly Pay</span>
        <span class="metric-val">${d.us_labor?.avg_hourly_earnings ? '$' + d.us_labor.avg_hourly_earnings : 'N/A'}</span>
      </div>
    `;

    // Recession
    const r = d.recession_analysis;
    get('risk-score').innerText = r.risk_score;
    get('risk-reason').innerText = r.reason;
    const rBadge = get('risk-status');
    rBadge.innerText = r.status;
    rBadge.className = `risk-badge risk-${r.status.toLowerCase().replace(/ /g, '-')}`;

    // Global GDP
    const badWords = ["income", "dividend", "total", "only", "members", "asia", "union", "area", "euro", "world", "situations", "ida", "ibrd", "classification"];
    const topEcons = d.global.top_economies.filter(c => 
        !badWords.some(w => c.country.toLowerCase().includes(w))
    ).slice(0, 5);

    if (topEcons.length === 0) {
        get('global-gdp').innerHTML = `<p style="text-align:center; opacity:0.6; padding:20px;">Loading global data...</p>`;
    } else {
        get('global-gdp').innerHTML = `<table class="mini-table">` + 
          topEcons.map((c, i) => `<tr><td><span class="rank-num">#${i+1}</span> ${c.country}</td><td>$${(c.gdp_billions/1000).toFixed(1)}T</td></tr>`).join("") + 
          `</table>`;
    }

    // Global Jobs
    const topJobs = d.global.best_for_jobs.filter(c => 
        !badWords.some(w => c.country.toLowerCase().includes(w))
    ).slice(0, 5);

    if (topJobs.length === 0) {
        get('global-jobs').innerHTML = `<p style="text-align:center; opacity:0.6; padding:20px;">Loading job data...</p>`;
    } else {
        get('global-jobs').innerHTML = `<table class="mini-table">` + 
          topJobs.map((c, i) => `<tr><td><span class="rank-num">#${i+1}</span> ${c.country}</td><td>${c.unemployment_rate.toFixed(1)}%</td></tr>`).join("") + 
          `</table>`;
    }

    // FX
    if (d.fx_rates && Object.keys(d.fx_rates).length > 0) {
        get('fx-stats').innerHTML = Object.entries(d.fx_rates).map(([k,v]) => 
          `<div class="metric-row"><span>${k}</span><span class="metric-val">${v}</span></div>`
        ).join("");
    } else {
        get('fx-stats').innerHTML = `<p style="text-align:center; opacity:0.6; padding:20px;">FX data unavailable</p>`;
    }

  })
  .catch(e => {
      clearTimeout(loadTimeout);
      console.error(e);
      document.getElementById('ai-summary').innerText = "‚ùå Error loading data. Ensure economyflow.json exists and is valid.";
  });
</script>
</body>
</html>
