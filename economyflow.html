<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EconomyFlow</title>

<style>
/* --- SAME DESIGN SYSTEM AS NEWSFLOW --- */
:root {
  --bg:#f4f1ea; --card:#fff; --text:#2d2d2d; --title:#1a1a1a;
  --border:#d1d1d1; --highlight:#667eea;
  --success:#16a34a; --warning:#f59e0b; --danger:#dc2626;
}
body.dark-mode {
  --bg:#1a202c; --card:#2d3748; --text:#e2e8f0;
  --title:#fff; --border:#4a5568; --highlight:#63b3ed;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Georgia,serif;
  background:var(--bg);
  color:var(--text);
  padding:20px;
  line-height:1.6;
}
.container{max-width:1200px;margin:auto}

/* HEADER */
header{
  text-align:center;
  border-bottom:4px double var(--title);
  padding-bottom:20px;
  margin-bottom:30px;
  position:relative;
}
h1{font-size:3rem;letter-spacing:-1.5px}
.subtitle{
  font-family:sans-serif;
  font-weight:700;
  color:var(--highlight);
}
#timestamp{
  font-family:sans-serif;
  font-size:.8rem;
  opacity:.6;
  margin-top:6px;
}
.nav-link,.theme-btn{
  position:absolute;top:0;
  font-family:sans-serif;
  font-size:.85rem;
  font-weight:bold;
  padding:6px 12px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--highlight);
  border-radius:4px;
  cursor:pointer;
  text-decoration: none;
}
.nav-link{left:0;}
.theme-btn{right:0;color:var(--text)}

/* AI INTELLIGENCE BOX */
#global-intelligence-box{
  background:var(--card);
  border-left:8px solid var(--highlight);
  padding:25px;
  margin-bottom:35px;
  box-shadow:0 4px 8px rgba(0,0,0,.05);
}
.ai-title{
  font-family:sans-serif;
  font-size:1.2rem;
  font-weight:bold;
  color:var(--highlight);
  margin-bottom:5px;
}
.ai-sub{
  font-family:sans-serif; font-size:.9rem; opacity:.7; margin-bottom:15px; font-style:italic;
}
.impact{
  background:rgba(0,0,0,.03);
  padding:15px; margin-top:15px;
  border-left:4px solid var(--highlight);
  font-family:sans-serif; font-size:0.95rem;
}
.impact ul{margin-top:8px;padding-left:20px}

/* GRID LAYOUT */
#data-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(350px, 1fr));
  gap:25px;
}

/* CARDS */
.card{
  background:var(--card);
  border:1px solid var(--border);
  padding:20px;
  box-shadow:0 2px 4px rgba(0,0,0,.05);
}
.card h3{
  font-family:sans-serif;
  font-size:.9rem;
  letter-spacing:1px;
  color:var(--highlight);
  margin-bottom:15px;
  text-transform: uppercase;
  border-bottom: 1px solid var(--border);
  padding-bottom: 10px;
}

/* METRICS & TABLES */
.metric-row{
  display:flex; justify-content:space-between;
  padding:8px 0; border-bottom:1px solid var(--border);
  font-family:sans-serif; font-size:0.95rem;
}
.metric-row:last-child{border-bottom:none}
.metric-val{ font-family:monospace; font-weight:bold; font-size:1.1rem; }
.sub-val { font-size: 0.8rem; opacity: 0.7; font-weight: normal; margin-left: 5px; }

/* MINI TABLES FOR GLOBAL DATA */
.mini-table { width: 100%; border-collapse: collapse; font-family: sans-serif; font-size: 0.9rem; }
.mini-table td { padding: 6px 0; border-bottom: 1px solid var(--border); }
.mini-table td:last-child { text-align: right; font-family: monospace; font-weight: bold; }
.rank-num { color: var(--highlight); font-weight: bold; margin-right: 8px; }

/* RECESSION BADGE */
.risk-badge{
  display:inline-block; padding:5px 10px; border-radius:4px;
  font-family:sans-serif; font-size:.8rem; font-weight:bold;
  margin-top: 5px;
}
.risk-low{background:#d1fae5;color:#065f46}
.risk-moderate{background:#fef3c7;color:#92400e}
.risk-high{background:#fee2e2;color:#991b1b}
.risk-very-low{background:#d1fae5;color:#065f46}
.risk-critical{background:#fee2e2;color:#991b1b}

/* GLOBAL SEARCH */
#global-search-wrap { margin-bottom: 20px; }
#global-search { width: 100%; max-width: 500px; margin: 0 auto; display: block; padding: 12px 16px; font-size: 1rem; border: 2px solid var(--border); border-radius: 8px; background: var(--card); color: var(--text); }
#global-search::placeholder { opacity: .7; }
#global-search:focus { outline: none; border-color: var(--highlight); }
.search-highlight { background: rgba(102, 126, 234, 0.25) !important; border-radius: 4px; }

/* TOOLTIPS */
.tooltip-wrap { position: relative; display: inline-block; }
.tooltip-icon { display: inline-flex; align-items: center; justify-content: center; width: 16px; height: 16px; border-radius: 50%; background: var(--highlight); color: #fff; font-size: 10px; font-weight: bold; cursor: help; margin-left: 4px; vertical-align: middle; }
.tooltip-icon:hover + .tooltip-text { opacity: 1; visibility: visible; }
.tooltip-text { position: absolute; left: 0; bottom: 100%; margin-bottom: 4px; padding: 8px 10px; background: var(--title); color: #fff; font-size: 0.75rem; font-family: sans-serif; border-radius: 6px; white-space: nowrap; max-width: 220px; white-space: normal; opacity: 0; visibility: hidden; transition: opacity .15s, visibility .15s; z-index: 10; pointer-events: none; }

/* TREND INDICATORS */
.trend-up { color: var(--success); font-weight: bold; }
.trend-down { color: var(--danger); font-weight: bold; }
.trend-stable { color: var(--text); opacity: .9; }
.trend-desc { font-size: 0.8rem; margin-left: 4px; }

/* RANK CIRCLE (Top Economies) */
.rank-circle { display: inline-flex; align-items: center; justify-content: center; min-width: 26px; height: 26px; border-radius: 50%; background: var(--highlight); color: #fff; font-weight: bold; font-size: 0.85rem; margin-right: 8px; }
.rank-change-up { color: var(--success); font-weight: bold; font-size: 0.85rem; margin-left: 4px; }

/* FX TILE */
.fx-base-label { font-size: 0.85rem; opacity: .85; margin-bottom: 10px; }
.fx-filter-bar { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 12px; align-items: center; }
.fx-filter-bar input { padding: 6px 10px; border: 1px solid var(--border); border-radius: 4px; background: var(--card); color: var(--text); font-size: 0.9rem; flex: 1; min-width: 140px; }
.fx-filter-bar select { padding: 6px 10px; border: 1px solid var(--border); border-radius: 4px; background: var(--card); color: var(--text); font-size: 0.9rem; }
.fx-row { display: flex; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--border); font-family: sans-serif; font-size: 0.95rem; }
.fx-row:last-child { border-bottom: none; }
.fx-flag { width: 24px; height: 24px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 16px; line-height: 1; margin-right: 10px; flex-shrink: 0; }
.fx-name { flex: 1; }
.fx-val { font-family: monospace; font-weight: bold; }
#fx-list { max-height: 320px; overflow-y: auto; }
#fx-list.view-all { max-height: 70vh; }
.fx-view-all-wrap { margin-top: 10px; text-align: center; }
.fx-view-all-wrap button { padding: 8px 20px; border: 1px solid var(--border); background: var(--card); color: var(--highlight); border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 0.9rem; }
.fx-view-all-wrap button:hover { background: var(--highlight); color: #fff; }

/* INDEXES TIMEFRAME TOGGLE */
.index-timeframe { display: flex; gap: 6px; margin-bottom: 12px; flex-wrap: wrap; }
.index-timeframe button { padding: 6px 12px; border: 1px solid var(--border); background: var(--card); color: var(--text); border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
.index-timeframe button.active { background: var(--highlight); color: #fff; border-color: var(--highlight); }

/* ECONOMIES TABLE */
.economies-table { width: 100%; border-collapse: collapse; font-family: sans-serif; font-size: 0.9rem; }
.economies-table th { text-align: left; padding: 8px 0; border-bottom: 2px solid var(--border); color: var(--highlight); }
.economies-table td { padding: 8px 0; border-bottom: 1px solid var(--border); }
.economies-table td.num { text-align: right; font-family: monospace; font-weight: bold; }

footer{ margin-top:50px; padding-top:20px; text-align:center; font-family:sans-serif; font-size:.8rem; opacity:.6; border-top:1px solid var(--border); }
</style>
</head>

<body>
<div class="container">
<header>
  <a href="index.html" class="nav-link">‚Üê Back</a>
  <h1>EconomyFlow</h1>
  <div class="subtitle">Macro Signals & Global FX Intelligence</div>
  <div id="timestamp">Loading data...</div>
  <button class="theme-btn" onclick="toggleTheme()" id="themeBtn">Dark Mode</button>
</header>

<div id="global-search-wrap" class="container">
  <input type="text" id="global-search" placeholder="Search by country or code (e.g., India or INR)‚Ä¶" aria-label="Global search">
</div>

<div id="global-intelligence-box">
  <div class="ai-title">ü§ñ AI Macro Outlook</div>
  <div class="ai-sub">GDP ¬∑ Labor ¬∑ Rates ¬∑ FX</div>
  <div id="ai-summary" style="font-size:1.1rem; margin-bottom:15px;">Loading analysis...</div>

  <div class="impact" style="border-left-color:var(--success)">
    <strong>What Matters Today</strong>
    <ul id="matters-list"></ul>
  </div>

  <div class="impact" style="border-left-color:var(--warning)">
    <strong>Strategic Outlook (3‚Äì6 Months)</strong>
    <p id="outlook-text" style="margin-top:5px"></p>
  </div>

  <div class="impact">
    <strong>Recommended Actions</strong>
    <ul id="action-list"></ul>
  </div>

  <div class="impact" id="market-pulse-box" style="display:none;">
    <strong>Market Pulse</strong>
    <p id="market-pulse-text" style="margin-top:5px"></p>
  </div>
</div>

<div id="data-grid">
  
  <div class="card">
    <h3>üá∫üá∏ U.S. Macro</h3>
    <div id="us-stats">Loading...</div>
  </div>

  <div class="card">
    <h3>üë∑ U.S. Labor</h3>
    <div id="labor-stats">Loading...</div>
  </div>

  <div class="card">
    <h3>üìâ Recession Risk</h3>
    <div style="text-align:center; padding:15px 0;">
      <div id="risk-score" style="font-size:3rem;font-weight:bold; line-height:1">‚Äî</div>
      <div id="risk-status" class="risk-badge">Calculating...</div>
      <p id="risk-reason" style="margin-top:10px; font-size:0.85rem; opacity:0.8; font-family:sans-serif; font-style:italic;">‚Äî</p>
    </div>
  </div>

  <div class="card">
    <h3>üõ¢Ô∏è Commodities</h3>
    <div id="commodities-stats">Loading...</div>
  </div>

  <div class="card">
    <h3>üìä Market Indexes</h3>
    <div id="indexes-stats">Loading...</div>
  </div>

  <div class="card">
    <h3>üìÖ Economic Calendar</h3>
    <div id="calendar-stats">Loading...</div>
  </div>

  <div class="card" id="card-economies">
    <h3>üåç Top Economies</h3>
    <div id="global-gdp">Loading...</div>
  </div>

  <div class="card">
    <h3>üíº Best Job Markets</h3>
    <div id="global-jobs">Loading...</div>
  </div>

  <div class="card card-fx" id="card-fx">
    <h3>üí± Currencies</h3>
    <p class="fx-base-label">Base: 1 U.S. Dollar (USD)</p>
    <div class="fx-filter-bar">
      <input type="text" id="fx-search" placeholder="Search by country or code (e.g., India or INR)" aria-label="FX search">
      <select id="fx-sort" aria-label="Sort FX">
        <option value="az">A‚ÄìZ</option>
        <option value="high">Value: High to Low</option>
        <option value="low">Value: Low to High</option>
      </select>
    </div>
    <div id="fx-list">Loading...</div>
    <div id="fx-view-all-wrap" class="fx-view-all-wrap"></div>
  </div>

</div>
</div>

<footer>¬© 2026 NewsFlow AI</footer>

<script>
// 1. THEME
const themeBtn = document.getElementById('themeBtn');
function toggleTheme(){
  document.body.classList.toggle('dark-mode');
  const d = document.body.classList.contains('dark-mode');
  localStorage.setItem('pref-theme', d);
  themeBtn.innerText = d ? "Light Mode" : "Dark Mode";
}
if(localStorage.getItem('pref-theme')==="true"){ document.body.classList.add('dark-mode'); themeBtn.innerText = "Light Mode"; }

const get = (id) => document.getElementById(id);

// 2. CURRENCY CODE -> Full name + flag (for FX human-readable display and search)
const CURRENCY_MAP = {
  AED:{n:"UAE Dirham",c:"United Arab Emirates",f:"üá¶üá™"},AFN:{n:"Afghan Afghani",c:"Afghanistan",f:"üá¶üá´"},
  ALL:{n:"Albanian Lek",c:"Albania",f:"üá¶üá±"},AMD:{n:"Armenian Dram",c:"Armenia",f:"üá¶üá≤"},
  AOA:{n:"Angolan Kwanza",c:"Angola",f:"üá¶üá¥"},ARS:{n:"Argentine Peso",c:"Argentina",f:"üá¶üá∑"},
  AUD:{n:"Australian Dollar",c:"Australia",f:"üá¶üá∫"},AZN:{n:"Azerbaijani Manat",c:"Azerbaijan",f:"üá¶üáø"},
  BAM:{n:"Bosnia-Herzegovina Mark",c:"Bosnia and Herzegovina",f:"üáßüá¶"},BBD:{n:"Barbadian Dollar",c:"Barbados",f:"üáßüáß"},
  BDT:{n:"Bangladeshi Taka",c:"Bangladesh",f:"üáßüá©"},BGN:{n:"Bulgarian Lev",c:"Bulgaria",f:"üáßüá¨"},
  BHD:{n:"Bahraini Dinar",c:"Bahrain",f:"üáßüá≠"},BIF:{n:"Burundian Franc",c:"Burundi",f:"üáßüáÆ"},
  BND:{n:"Brunei Dollar",c:"Brunei",f:"üáßüá≥"},BOB:{n:"Bolivian Boliviano",c:"Bolivia",f:"üáßüá¥"},
  BRL:{n:"Brazilian Real",c:"Brazil",f:"üáßüá∑"},BSD:{n:"Bahamian Dollar",c:"Bahamas",f:"üáßüá∏"},
  BWP:{n:"Botswana Pula",c:"Botswana",f:"üáßüáº"},BYN:{n:"Belarusian Ruble",c:"Belarus",f:"üáßüáæ"},
  BZD:{n:"Belize Dollar",c:"Belize",f:"üáßüáø"},CAD:{n:"Canadian Dollar",c:"Canada",f:"üá®üá¶"},
  CHF:{n:"Swiss Franc",c:"Switzerland",f:"üá®üá≠"},CLP:{n:"Chilean Peso",c:"Chile",f:"üá®üá±"},
  CNY:{n:"Chinese Yuan",c:"China",f:"üá®üá≥"},COP:{n:"Colombian Peso",c:"Colombia",f:"üá®üá¥"},
  CRC:{n:"Costa Rican Col√≥n",c:"Costa Rica",f:"üá®üá∑"},CUP:{n:"Cuban Peso",c:"Cuba",f:"üá®üá∫"},
  CZK:{n:"Czech Koruna",c:"Czech Republic",f:"üá®üáø"},DKK:{n:"Danish Krone",c:"Denmark",f:"üá©üá∞"},
  DOP:{n:"Dominican Peso",c:"Dominican Republic",f:"üá©üá¥"},DZD:{n:"Algerian Dinar",c:"Algeria",f:"üá©üáø"},
  EGP:{n:"Egyptian Pound",c:"Egypt",f:"üá™üá¨"},EUR:{n:"Euro",c:"Eurozone",f:"üá™üá∫"},
  GBP:{n:"British Pound",c:"United Kingdom",f:"üá¨üáß"},GEL:{n:"Georgian Lari",c:"Georgia",f:"üá¨üá™"},
  GHS:{n:"Ghanaian Cedi",c:"Ghana",f:"üá¨üá≠"},GMD:{n:"Gambian Dalasi",c:"Gambia",f:"üá¨üá≤"},
  GNF:{n:"Guinean Franc",c:"Guinea",f:"üá¨üá≥"},GTQ:{n:"Guatemalan Quetzal",c:"Guatemala",f:"üá¨üáπ"},
  HKD:{n:"Hong Kong Dollar",c:"Hong Kong",f:"üá≠üá∞"},HNL:{n:"Honduran Lempira",c:"Honduras",f:"üá≠üá≥"},
  HRK:{n:"Croatian Kuna",c:"Croatia",f:"üá≠üá∑"},HTG:{n:"Haitian Gourde",c:"Haiti",f:"üá≠üáπ"},
  HUF:{n:"Hungarian Forint",c:"Hungary",f:"üá≠üá∫"},IDR:{n:"Indonesian Rupiah",c:"Indonesia",f:"üáÆüá©"},
  ILS:{n:"Israeli Shekel",c:"Israel",f:"üáÆüá±"},INR:{n:"Indian Rupee",c:"India",f:"üáÆüá≥"},
  IQD:{n:"Iraqi Dinar",c:"Iraq",f:"üáÆüá∂"},IRR:{n:"Iranian Rial",c:"Iran",f:"üáÆüá∑"},
  ISK:{n:"Icelandic Kr√≥na",c:"Iceland",f:"üáÆüá∏"},JMD:{n:"Jamaican Dollar",c:"Jamaica",f:"üáØüá≤"},
  JOD:{n:"Jordanian Dinar",c:"Jordan",f:"üáØüá¥"},JPY:{n:"Japanese Yen",c:"Japan",f:"üáØüáµ"},
  KES:{n:"Kenyan Shilling",c:"Kenya",f:"üá∞üá™"},KGS:{n:"Kyrgyzstani Som",c:"Kyrgyzstan",f:"üá∞üá¨"},
  KHR:{n:"Cambodian Riel",c:"Cambodia",f:"üá∞üá≠"},KRW:{n:"South Korean Won",c:"South Korea",f:"üá∞üá∑"},
  KWD:{n:"Kuwaiti Dinar",c:"Kuwait",f:"üá∞üáº"},KZT:{n:"Kazakhstani Tenge",c:"Kazakhstan",f:"üá∞üáø"},
  LAK:{n:"Lao Kip",c:"Laos",f:"üá±üá¶"},LBP:{n:"Lebanese Pound",c:"Lebanon",f:"üá±üáß"},
  LKR:{n:"Sri Lankan Rupee",c:"Sri Lanka",f:"üá±üá∞"},MAD:{n:"Moroccan Dirham",c:"Morocco",f:"üá≤üá¶"},
  MDL:{n:"Moldovan Leu",c:"Moldova",f:"üá≤üá©"},MXN:{n:"Mexican Peso",c:"Mexico",f:"üá≤üáΩ"},
  MYR:{n:"Malaysian Ringgit",c:"Malaysia",f:"üá≤üáæ"},NGN:{n:"Nigerian Naira",c:"Nigeria",f:"üá≥üá¨"},
  NIO:{n:"Nicaraguan C√≥rdoba",c:"Nicaragua",f:"üá≥üáÆ"},NOK:{n:"Norwegian Krone",c:"Norway",f:"üá≥üá¥"},
  NPR:{n:"Nepalese Rupee",c:"Nepal",f:"üá≥üáµ"},NZD:{n:"New Zealand Dollar",c:"New Zealand",f:"üá≥üáø"},
  OMR:{n:"Omani Rial",c:"Oman",f:"üá¥üá≤"},PAB:{n:"Panamanian Balboa",c:"Panama",f:"üáµüá¶"},
  PEN:{n:"Peruvian Sol",c:"Peru",f:"üáµüá™"},PHP:{n:"Philippine Peso",c:"Philippines",f:"üáµüá≠"},
  PKR:{n:"Pakistani Rupee",c:"Pakistan",f:"üáµüá∞"},PLN:{n:"Polish Z≈Çoty",c:"Poland",f:"üáµüá±"},
  PYG:{n:"Paraguayan Guaran√≠",c:"Paraguay",f:"üáµüáæ"},QAR:{n:"Qatari Riyal",c:"Qatar",f:"üá∂üá¶"},
  RON:{n:"Romanian Leu",c:"Romania",f:"üá∑üá¥"},RSD:{n:"Serbian Dinar",c:"Serbia",f:"üá∑üá∏"},
  RUB:{n:"Russian Ruble",c:"Russia",f:"üá∑üá∫"},RWF:{n:"Rwandan Franc",c:"Rwanda",f:"üá∑üáº"},
  SAR:{n:"Saudi Riyal",c:"Saudi Arabia",f:"üá∏üá¶"},SEK:{n:"Swedish Krona",c:"Sweden",f:"üá∏üá™"},
  SGD:{n:"Singapore Dollar",c:"Singapore",f:"üá∏üá¨"},THB:{n:"Thai Baht",c:"Thailand",f:"üáπüá≠"},
  TND:{n:"Tunisian Dinar",c:"Tunisia",f:"üáπüá≥"},TRY:{n:"Turkish Lira",c:"Turkey",f:"üáπüá∑"},
  TWD:{n:"Taiwan Dollar",c:"Taiwan",f:"üáπüáº"},TZS:{n:"Tanzanian Shilling",c:"Tanzania",f:"üáπüáø"},
  UAH:{n:"Ukrainian Hryvnia",c:"Ukraine",f:"üá∫üá¶"},UGX:{n:"Ugandan Shilling",c:"Uganda",f:"üá∫üá¨"},
  USD:{n:"US Dollar",c:"United States",f:"üá∫üá∏"},UYU:{n:"Uruguayan Peso",c:"Uruguay",f:"üá∫üáæ"},
  UZS:{n:"Uzbekistani Som",c:"Uzbekistan",f:"üá∫üáø"},VND:{n:"Vietnamese Dong",c:"Vietnam",f:"üáªüá≥"},
  XAF:{n:"Central African CFA Franc",c:"CEMAC",f:"üá≤üá±"},XCD:{n:"East Caribbean Dollar",c:"Caribbean",f:"üá¶üá¨"},
  ZAR:{n:"South African Rand",c:"South Africa",f:"üáøüá¶"},ZMW:{n:"Zambian Kwacha",c:"Zambia",f:"üáøüá≤"}
};
function getCurrencyInfo(code){ const c = CURRENCY_MAP[code]; return c ? { name: c.n, country: c.c, flag: c.f } : { name: code, country: '', flag: 'üí±' }; }
function currencyMatchesSearch(code, q){ if(!q) return true; const info = getCurrencyInfo(code); const s = q.toLowerCase(); return code.toLowerCase().includes(s) || info.name.toLowerCase().includes(s) || info.country.toLowerCase().includes(s); }

// 3. TOOLTIP TEXTS
const TOOLTIPS = {
  yield_curve: "Spread between 10-year and 2-year Treasury yields. Negative (inverted) often precedes recession.",
  jolts: "Job Openings and Labor Turnover Survey: number of unfilled jobs. Indicates labor market tightness.",
  gdp_growth: "Quarter-over-quarter real GDP growth. Two negative quarters in a row = technical recession.",
  unemployment: "Share of labor force without a job, seeking work.",
  inflation: "Year-over-year change in Consumer Price Index (CPI).",
  consumer_sentiment: "University of Michigan index of how confident households feel about the economy."
};

// 4. AGGREGATE FILTER (client-side backup)
const BAD_KEYWORDS = ['dividend','income','ibrd','ida','oecd','excluding',' countries','east asia','europe','latin america','caribbean','middle east','north africa','south asia','sub-saharan','pacific','central asia','arab','euro','union','baltics','afghanistan','pakistan','central europe'];
function isRealCountry(name){ const n = name.toLowerCase(); return !BAD_KEYWORDS.some(k => n.includes(k)) && !name.includes('&') && !name.includes('('); }

// 4. DATA LOADING WITH DETAILED ERROR REPORTING
console.log('Starting data fetch...');

fetch(`economyflow.json?t=${Date.now()}`)
  .then(response => {
    console.log('Fetch response received:', response.status);
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    return response.json();
  })
  .then(d => {
    console.log('JSON parsed successfully:', d);
    
    // Timestamp
    get('timestamp').innerText = "UPDATED: " + (d.last_updated_human || 'Unknown');

    // AI Section
    if(d.ai) {
        get('ai-summary').innerText = d.ai.connected_summary || 'No summary available';
        get('matters-list').innerHTML = (d.ai.what_matters_today || []).map(x=>`<li>${x}</li>`).join("") || '<li>No data</li>';
        get('action-list').innerHTML = (d.ai.what_to_do_next || []).map(x=>`<li>${x}</li>`).join("") || '<li>No actions</li>';
        get('outlook-text').innerText = d.ai.strategic_outlook || 'No outlook available';
        const mp = d.ai.market_pulse;
        if (mp) {
          get('market-pulse-text').innerText = mp;
          get('market-pulse-box').style.display = 'block';
        } else {
          get('market-pulse-box').style.display = 'none';
        }
    } else {
        get('ai-summary').innerText = "AI analysis unavailable";
        get('market-pulse-box').style.display = 'none';
        console.warn('No AI data in JSON');
    }

    // US Macro ‚Äî contextual labels, trend arrows, tooltips
    if (d.us_economy) {
      const u = d.us_economy;
      const gq = u.gdp_growth_q || [];
      const gqStr = gq.length >= 4 ? `Q-3: ${gq[0]}% ¬∑ Q-2: ${gq[1]}% ¬∑ Q-1: ${gq[2]}% ¬∑ Q0: ${gq[3]}%` : (u.gdp_growth != null ? `Q0: ${u.gdp_growth}%` : '‚Äî');
      const trend3q = u.gdp_growth_3q_trend;
      const trend3qClass = trend3q === 'accelerating' ? 'trend-up' : (trend3q === 'decelerating' ? 'trend-down' : 'trend-stable');
      const trend3qLabel = trend3q === 'accelerating' ? '‚Üë Improving' : (trend3q === 'decelerating' ? '‚Üì Weakening' : '‚Üí Stable');
      const unemp = u.unemployment; const unempPrev = u.unemployment_prev;
      const unempDir = (unemp != null && unempPrev != null) ? (unemp < unempPrev ? 'Down from ' + unempPrev + '% last month' : (unemp > unempPrev ? 'Up from ' + unempPrev + '% last month' : 'Unchanged from ' + unempPrev + '%')) : '';
      const unempTrend = (unemp != null && unempPrev != null) ? (unemp < unempPrev ? '<span class="trend-up">‚Üì Improving</span>' : (unemp > unempPrev ? '<span class="trend-down">‚Üë Weakening</span>' : '<span class="trend-stable">‚Üí Stable</span>')) : '';
      const tt = (key) => { const t = TOOLTIPS[key]; return t ? `<span class="tooltip-wrap"><span class="tooltip-icon" aria-hidden="true">i</span><span class="tooltip-text">${t}</span></span>` : ''; };
      get('us-stats').innerHTML = `
        <div class="metric-row"><span>GDP growth (quarterly)</span><span class="metric-val">${gqStr}</span></div>
        <div class="metric-row"><span>3-quarter trend</span><span class="metric-val ${trend3qClass}">${trend3qLabel}</span></div>
        <div class="metric-row"><span>Unemployment ${tt('unemployment')}</span><span class="metric-val">Current: ${unemp ?? '‚Äî'}% <span class="sub-val">(${unempDir})</span> ${unempTrend}</span></div>
        <div class="metric-row"><span>Inflation (annual) ${tt('inflation')}</span><span class="metric-val">${u.inflation ?? '‚Äî'}%</span></div>
        <div class="metric-row"><span>Interest Rate</span><span class="metric-val">${u.interest_rate ?? '‚Äî'}%</span></div>
        <div class="metric-row"><span>Yield Curve (10Y-2Y) ${tt('yield_curve')}</span><span class="metric-val">${u.yield_curve ?? '‚Äî'}% <span class="sub-val">(${d.derived_signals?.yield_curve_state || 'unknown'})</span></span></div>
        <div class="metric-row"><span>Consumer Sentiment ${tt('consumer_sentiment')}</span><span class="metric-val">${u.consumer_sentiment ?? '‚Äî'}</span></div>
      `;
    } else {
      get('us-stats').innerHTML = '<p style="opacity:0.6">Data unavailable</p>';
    }

    // US Labor ‚Äî contextual labels, trend indicators, JOLTS tooltip
    const BLS_LABELS = {
      total_employment: 'Total Employment (thous.)',
      avg_hourly_earnings: 'Avg Hourly Earnings',
      financial_employment: 'Financial Activities',
      trade_transport_employment: 'Trade/Transportation',
      professional_employment: 'Professional Services',
      leisure_employment: 'Leisure/Hospitality',
      avg_weekly_hours: 'Avg Weekly Hours',
      job_openings: 'Job Openings',
      retail_hourly_earnings: 'Retail Hourly Earnings',
      financial_hourly_earnings: 'Financial Hourly Earnings'
    };
    if (d.us_labor) {
      const rows = [];
      for (const [key, label] of Object.entries(BLS_LABELS)) {
        const v = d.us_labor[key];
        if (v == null) continue;
        const joltTip = key === 'job_openings' ? `<span class="tooltip-wrap"><span class="tooltip-icon" aria-hidden="true">i</span><span class="tooltip-text">${TOOLTIPS.jolts}</span></span>` : '';
        if (typeof v === 'object' && v.current != null) {
          const cur = v.current; const prev = v.prev; const dPct = v.delta_pct;
          const dir = (prev != null && dPct != null) ? (dPct > 0 ? 'Up from last month' : dPct < 0 ? 'Down from last month' : 'Unchanged') : '';
          const trendClass = dPct != null ? (dPct > 0 ? 'trend-up' : (dPct < 0 ? 'trend-down' : 'trend-stable')) : '';
          const trendLabel = dPct != null ? (dPct > 0 ? '‚Üë Improving' : (dPct < 0 ? '‚Üì Weakening' : '‚Üí Stable')) : '';
          const curFmt = typeof cur === 'number' && cur > 1000 ? cur.toLocaleString('en-US', {maximumFractionDigits:0}) : cur;
          rows.push(`<div class="metric-row"><span>${label} ${joltTip}</span><span class="metric-val">Current: ${curFmt} <span class="sub-val">(${dir})</span> <span class="${trendClass}">${trendLabel}</span></span></div>`);
        } else {
          rows.push(`<div class="metric-row"><span>${label}</span><span class="metric-val">${v}</span></div>`);
        }
      }
      get('labor-stats').innerHTML = rows.length ? rows.join('') : '<p style="opacity:0.6">No labor data</p>';
    } else {
      get('labor-stats').innerHTML = '<p style="opacity:0.6">Data unavailable</p>';
    }

    // Recession
    if (d.recession_analysis) {
      const r = d.recession_analysis;
      get('risk-score').innerText = r.risk_score || '--';
      get('risk-reason').innerText = r.reason || 'No analysis';
      const rBadge = get('risk-status');
      rBadge.innerText = r.status || 'UNKNOWN';
      rBadge.className = `risk-badge risk-${(r.status || 'unknown').toLowerCase().replace(/ /g, '-')}`;
    } else {
      console.error('No recession_analysis data');
    }

    // Commodities ‚Äî human-readable units: USD per Ounce (Gold), Price per Barrel (Crude)
    if (d.commodities && Object.keys(d.commodities).length > 0) {
      const unitLabel = (name, unit) => {
        if (name.toLowerCase().includes('gold')) return 'USD per Ounce';
        if (name.toLowerCase().includes('crude') || name.toLowerCase().includes('oil')) return 'Price per Barrel';
        return unit || '';
      };
      get('commodities-stats').innerHTML = Object.entries(d.commodities).map(([name, o]) => {
        const unit = unitLabel(name, o.unit); const price = o.price; const prev = o.prev; const ch = o.change;
        const chStr = ch != null ? ` Œî ${ch >= 0 ? '+' : ''}${ch}%` : '';
        return `<div class="metric-row"><span>${name} (${unit})</span><span class="metric-val">${price ?? '‚Äî'} <span class="sub-val">prev ${prev ?? '‚Äî'}${chStr}</span></span></div>`;
      }).join('');
    } else {
      get('commodities-stats').innerHTML = '<p style="opacity:0.6">No commodities data</p>';
    }

    // Market Indexes ‚Äî 1D / 1W / 1M timeframe toggle
    if (d.market_indexes && Object.keys(d.market_indexes).length > 0) {
      const indexesData = d.market_indexes;
      const tfDiv = get('index-timeframe');
      tfDiv.innerHTML = '<button type="button" data-tf="1d">1D</button><button type="button" data-tf="7d">1W</button><button type="button" data-tf="30d" class="active">1M</button>';
      function renderIndexes(tf) {
        const key = tf === '1d' ? 'change_1d' : (tf === '7d' ? 'change_7d' : 'change_30d');
        const label = tf === '1d' ? '1 day' : (tf === '7d' ? '1 week' : '1 month');
        get('indexes-stats').innerHTML = Object.entries(indexesData).map(([name, o]) => {
          const price = o.price; const ch = o[key];
          const chStr = ch != null ? ` Œî ${label}: ${ch >= 0 ? '+' : ''}${ch}%` : '';
          return `<div class="metric-row"><span>${name}</span><span class="metric-val">${price ?? '‚Äî'} <span class="sub-val">${chStr}</span></span></div>`;
        }).join('');
      }
      tfDiv.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          tfDiv.querySelectorAll('button').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          renderIndexes(btn.dataset.tf);
        });
      });
      renderIndexes('30d');
    } else {
      get('index-timeframe').innerHTML = '';
      get('indexes-stats').innerHTML = '<p style="opacity:0.6">No index data</p>';
    }

    // Economic Calendar
    if (d.economic_calendar && d.economic_calendar.length > 0) {
      get('calendar-stats').innerHTML = d.economic_calendar.slice(0, 8).map(ev => 
        `<div class="metric-row"><span>${ev.event || 'Event'}</span><span class="metric-val">${ev.date || '‚Äî'} <span class="sub-val">${ev.actual || ''}</span></span></div>`
      ).join('');
    } else {
      get('calendar-stats').innerHTML = '<p style="opacity:0.6">No calendar data</p>';
    }

    // Top Economies ‚Äî table: Rank (circle), Country, GDP (USD), Annual Growth; green +1 if moved up
    if (d.global && d.global.top_economies) {
      const realCountries = d.global.top_economies.filter(c => isRealCountry(c.country)).slice(0, 10);
      if (realCountries.length > 0) {
        get('global-gdp').innerHTML = `
          <table class="economies-table" id="economies-table">
            <thead><tr><th>Rank</th><th>Country</th><th class="num">GDP (USD)</th><th class="num">Annual Growth</th></tr></thead>
            <tbody>
              ${realCountries.map((c, i) => {
                const rank = c.gdp_rank || i + 1; const dr = c.gdp_delta_rank;
                const rankChgHtml = (dr != null && dr > 0) ? ` <span class="rank-change-up">+${dr}</span>` : '';
                const g = c.gdp_billions; const yoy = c.gdp_yoy_pct;
                const gStr = g != null ? `$${(g/1000).toFixed(1)}T` : '‚Äî';
                const yoyStr = yoy != null ? `${yoy >= 0 ? '+' : ''}${yoy}%` : '‚Äî';
                return `<tr data-country="${(c.country || '').toLowerCase()}" data-code=""><td><span class="rank-circle">${rank}</span>${rankChgHtml}</td><td>${c.country}</td><td class="num">${gStr}</td><td class="num">${yoyStr}</td></tr>`;
              }).join('')}
            </tbody>
          </table>`;
      } else {
        get('global-gdp').innerHTML = '<p style="opacity:0.6; text-align:center">No real countries found</p>';
      }
    } else {
      get('global-gdp').innerHTML = '<p style="opacity:0.6">Data unavailable</p>';
    }

    // Best Job Markets ‚Äî table with rank circle, optional green +1
    if (d.global && d.global.best_for_jobs) {
      const realJobCountries = d.global.best_for_jobs.filter(c => isRealCountry(c.country) && c.unemployment_rate != null).slice(0, 10);
      if (realJobCountries.length > 0) {
        get('global-jobs').innerHTML = `
          <table class="economies-table">
            <thead><tr><th>Rank</th><th>Country</th><th class="num">Unemployment</th><th class="num">Change</th></tr></thead>
            <tbody>
              ${realJobCountries.map((c, i) => {
                const rank = c.unemployment_rank || i + 1; const dr = c.unemployment_delta_rank;
                const rankChgHtml = (dr != null && dr > 0) ? ` <span class="rank-change-up">+${dr}</span>` : '';
                const u = c.unemployment_rate; const dU = c.unemployment_delta;
                const dStr = dU != null ? `${dU >= 0 ? '+' : ''}${dU}` : '‚Äî';
                return `<tr data-country="${(c.country||'').toLowerCase()}"><td><span class="rank-circle">${rank}</span>${rankChgHtml}</td><td>${c.country}</td><td class="num">${u.toFixed(1)}%</td><td class="num">${dStr}</td></tr>`;
              }).join('')}
            </tbody>
          </table>`;
      } else {
        get('global-jobs').innerHTML = '<p style="opacity:0.6; text-align:center">No job data</p>';
      }
    } else {
      get('global-jobs').innerHTML = '<p style="opacity:0.6">Data unavailable</p>';
    }

    // FX ‚Äî full names, flags, filter/sort, View All (no pagination)
    if (d.fx_rates && Object.keys(d.fx_rates).length > 0) {
      const fxAll = Object.entries(d.fx_rates).map(([code, val]) => ({ code, val, ...getCurrencyInfo(code) }));
      const fxListEl = get('fx-list');
      let fxViewAll = false;
      function renderFx() {
        const q = (get('fx-search').value || '').trim();
        const sortBy = get('fx-sort').value;
        let list = fxAll.filter(x => currencyMatchesSearch(x.code, q));
        if (sortBy === 'high') list = list.slice().sort((a, b) => (b.val - a.val));
        else if (sortBy === 'low') list = list.slice().sort((a, b) => (a.val - b.val));
        else list = list.slice().sort((a, b) => a.code.localeCompare(b.code));
        const display = fxViewAll ? list : list.slice(0, 10);
        fxListEl.innerHTML = display.map((x) => {
          const code = x.code; const val = x.val; const name = x.name || code; const flag = x.flag; const country = (x.country || '').toLowerCase();
          const searchAttr = `data-code="${code}" data-name="${(name||'').toLowerCase()}" data-country="${country}"`;
          return `<div class="fx-row" ${searchAttr}><span class="fx-flag">${flag}</span><span class="fx-name">${code} ‚Äì ${name}</span><span class="fx-val">${val}</span></div>`;
        }).join('');
        fxListEl.classList.toggle('view-all', fxViewAll);
        const wrap = get('fx-view-all-wrap');
        if (list.length > 10) {
          wrap.innerHTML = `<button type="button" id="fx-view-all-btn">${fxViewAll ? 'Show less' : 'View All (' + list.length + ')'}</button>`;
          wrap.querySelector('button').onclick = () => { fxViewAll = !fxViewAll; renderFx(); };
        } else wrap.innerHTML = '';
      }
      get('fx-search').oninput = () => renderFx();
      get('fx-sort').onchange = () => renderFx();
      window.renderFx = renderFx;
      renderFx();
    } else {
      get('fx-list').innerHTML = '<p style="opacity:0.6">FX data unavailable</p>';
      get('fx-view-all-wrap').innerHTML = '';
    }

    // Global search ‚Äî filter FX by same query, show all matches, then highlight Top Economies + FX rows
    const globalSearchEl = get('global-search');
    globalSearchEl.oninput = function() {
      const q = (this.value || '').trim();
      const qLower = q.toLowerCase();
      if (window.renderFx) {
        get('fx-search').value = q;
        window.renderFx();
      }
      document.querySelectorAll('.fx-row, #economies-table tbody tr, #jobs-table tbody tr').forEach(el => {
        const code = (el.getAttribute('data-code') || '').toLowerCase();
        const name = (el.getAttribute('data-name') || '').toLowerCase();
        const country = (el.getAttribute('data-country') || '').toLowerCase();
        const text = (el.textContent || '').toLowerCase();
        const match = qLower && (code.includes(qLower) || name.includes(qLower) || country.includes(qLower) || text.includes(qLower));
        el.classList.toggle('search-highlight', !!match);
        if (match && el.scrollIntoView) el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      });
    };

    console.log('‚úÖ All data loaded successfully');

  })
  .catch(e => {
      console.error('‚ùå ERROR:', e);
      get('timestamp').innerText = "ERROR: " + e.message;
      get('ai-summary').innerHTML = `
        <div style="color:var(--danger); padding:15px; background:rgba(220,38,38,0.1); border-radius:5px;">
          <strong>Data Loading Failed</strong><br>
          ${e.message}<br><br>
          Check browser console (F12) for details.
        </div>
      `;
  });
</script>
</body>
</html>